<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2048 - ç‚œç…œä¹‹åšå®¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        h1 {
            color: #f0932b;
            margin-bottom: 20px;
            font-size: 2.5em;
            text-shadow: 0 0 20px rgba(240, 147, 43, 0.5);
        }
        
        .header {
            display: flex;
            gap: 30px;
            margin-bottom: 20px;
        }
        
        .score-box {
            background: rgba(255,255,255,0.1);
            padding: 15px 30px;
            border-radius: 10px;
            text-align: center;
        }
        
        .score-label {
            color: #aaa;
            font-size: 0.9em;
        }
        
        .score-value {
            color: #fff;
            font-size: 1.8em;
            font-weight: bold;
        }
        
        #gameCanvas {
            border-radius: 10px;
            background: #bbada0;
            box-shadow: 0 0 30px rgba(187, 173, 160, 0.5);
        }
        
        .controls {
            margin-top: 20px;
            color: #aaa;
            text-align: center;
        }
        
        .back-btn {
            display: inline-block;
            padding: 12px 30px;
            margin-top: 25px;
            background: linear-gradient(135deg, #f0932b 0%, #f5576c 100%);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
            transition: transform 0.3s;
        }
        
        .back-btn:hover {
            transform: translateY(-3px);
        }
        
        .restart-btn {
            display: inline-block;
            padding: 10px 25px;
            margin-left: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .restart-btn:hover {
            transform: translateY(-3px);
        }
    </style>
</head>
<body>
    <h1>ğŸ² 2048</h1>
    <div class="header">
        <div class="score-box">
            <div class="score-label">åˆ†æ•°</div>
            <div class="score-value" id="score">0</div>
        </div>
        <div class="score-box">
            <div class="score-label">æœ€é«˜åˆ†</div>
            <div class="score-value" id="highScore">0</div>
        </div>
    </div>
    <canvas id="gameCanvas" width="400" height="400"></canvas>
    <div class="controls">
        <p>ä½¿ç”¨æ–¹å‘é”® â†‘ â†“ â† â†’ ç§»åŠ¨æ–¹å— | ç©ºæ ¼é”®é‡æ–°å¼€å§‹</p>
        <button class="restart-btn" onclick="restartGame()">ğŸ”„ é‡æ–°å¼€å§‹</button>
    </div>
    <a href="index.html" class="back-btn">â† è¿”å›æ¸¸æˆé€‰æ‹©</a>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const highScoreEl = document.getElementById('highScore');
        
        const gridSize = 4;
        const cellSize = 95;
        const gap = 5;
        const gridPadding = 10;
        
        let grid = [];
        let score = 0;
        let highScore = localStorage.getItem('2048HighScore') || 0;
        let gameOver = false;
        let won = false;
        
        const colors = {
            0: '#cdc1b4',
            2: '#eee4da',
            4: '#ede0c8',
            8: '#f2b179',
            16: '#f59563',
            32: '#f67c5f',
            64: '#f65e3b',
            128: '#edcf72',
            256: '#edcc61',
            512: '#edc850',
            1024: '#edc53f',
            2048: '#edc22e'
        };
        
        const textColors = {
            2: '#776e65',
            4: '#776e65',
            default: '#f9f6f2'
        };
        
        highScoreEl.textContent = highScore;
        
        function initGame() {
            grid = Array(gridSize).fill(null).map(() => Array(gridSize).fill(0));
            score = 0;
            gameOver = false;
            won = false;
            scoreEl.textContent = score;
            addRandomTile();
            addRandomTile();
            draw();
        }
        
        function addRandomTile() {
            const empty = [];
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    if (grid[i][j] === 0) empty.push({ i, j });
                }
            }
            if (empty.length > 0) {
                const { i, j } = empty[Math.floor(Math.random() * empty.length)];
                grid[i][j] = Math.random() < 0.9 ? 2 : 4;
            }
        }
        
        function draw() {
            // èƒŒæ™¯
            ctx.fillStyle = '#faf8ef';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç½‘æ ¼èƒŒæ™¯
            ctx.fillStyle = '#bbada0';
            ctx.fillRect(gridPadding, gridPadding, 
                        gridSize * cellSize + (gridSize - 1) * gap,
                        gridSize * cellSize + (gridSize - 1) * gap);
            
            // ç»˜åˆ¶æ–¹å—
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    const x = gridPadding + j * (cellSize + gap);
                    const y = gridPadding + i * (cellSize + gap);
                    const value = grid[i][j];
                    
                    ctx.fillStyle = colors[value] || colors[2048];
                    ctx.beginPath();
                    ctx.roundRect(x, y, cellSize, cellSize, 5);
                    ctx.fill();
                    
                    if (value > 0) {
                        ctx.fillStyle = textColors[value] || textColors.default;
                        ctx.font = value < 100 ? 'bold 40px Arial' : value < 1000 ? 'bold 35px Arial' : 'bold 28px Arial';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillText(value, x + cellSize / 2, y + cellSize / 2);
                    }
                }
            }
            
            // æ¸¸æˆç»“æŸæç¤º
            if (gameOver) {
                ctx.fillStyle = 'rgba(238, 228, 218, 0.73)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#776e65';
                ctx.font = 'bold 50px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('æ¸¸æˆç»“æŸ!', canvas.width / 2, canvas.height / 2 - 20);
                ctx.font = '20px Arial';
                ctx.fillText('æŒ‰ç©ºæ ¼é”®é‡æ–°å¼€å§‹', canvas.width / 2, canvas.height / 2 + 30);
            }
            
            // è·èƒœæç¤º
            if (won) {
                ctx.fillStyle = 'rgba(237, 194, 46, 0.5)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#f9f6f2';
                ctx.font = 'bold 50px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('æ­å–œè¾¾åˆ°2048!', canvas.width / 2, canvas.height / 2 - 20);
                ctx.font = '20px Arial';
                ctx.fillText('æŒ‰æ–¹å‘é”®ç»§ç»­æ¸¸æˆ', canvas.width / 2, canvas.height / 2 + 30);
            }
        }
        
        function slide(row) {
            let arr = row.filter(val => val !== 0);
            let missing = gridSize - arr.length;
            let zeros = Array(missing).fill(0);
            return arr.concat(zeros);
        }
        
        function combine(row) {
            for (let i = 0; i < row.length - 1; i++) {
                if (row[i] !== 0 && row[i] === row[i + 1]) {
                    row[i] *= 2;
                    score += row[i];
                    scoreEl.textContent = score;
                    row[i + 1] = 0;
                }
            }
            return row;
        }
        
        function move(direction) {
            if (gameOver) return;
            
            let oldGrid = JSON.stringify(grid);
            
            for (let i = 0; i < gridSize; i++) {
                let row = grid[i].slice();
                if (direction === 'right') row.reverse();
                if (direction === 'left') row = slide(row);
                if (direction === 'up' || direction === 'down') {
                    let col = [];
                    for (let j = 0; j < gridSize; j++) col.push(grid[j][i]);
                    if (direction === 'down') col.reverse();
                    col = slide(col);
                    col = combine(col);
                    col = slide(col);
                    for (let j = 0; j < gridSize; j++) grid[j][i] = col[j];
                } else {
                    row = combine(row);
                    row = slide(row);
                    if (direction === 'right') row.reverse();
                    grid[i] = row;
                }
            }
            
            if (JSON.stringify(grid) !== oldGrid) {
                addRandomTile();
                
                // æ£€æŸ¥è·èƒœ
                if (!won && grid.some(row => row.includes(2048))) {
                    won = true;
                }
                
                // æ£€æŸ¥æ¸¸æˆç»“æŸ
                if (!canMove()) {
                    gameOver = true;
                    if (score > highScore) {
                        highScore = score;
                        localStorage.setItem('2048HighScore', highScore);
                        highScoreEl.textContent = highScore;
                    }
                }
            }
            
            draw();
        }
        
        function canMove() {
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    if (grid[i][j] === 0) return true;
                    if (j < gridSize - 1 && grid[i][j] === grid[i][j + 1]) return true;
                    if (i < gridSize - 1 && grid[i][j] === grid[i + 1][j]) return true;
                }
            }
            return false;
        }
        
        function restartGame() {
            initGame();
        }
        
        document.addEventListener('keydown', (e) => {
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.code)) {
                e.preventDefault();
                move(e.code.replace('Arrow', '').toLowerCase());
            }
            
            if (e.code === 'Space') {
                e.preventDefault();
                restartGame();
            }
        });
        
        // è§¦æ‘¸æ”¯æŒ
        let startX, startY;
        canvas.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        });
        
        canvas.addEventListener('touchend', (e) => {
            const endX = e.changedTouches[0].clientX;
            const endY = e.changedTouches[0].clientY;
            const dx = endX - startX;
            const dy = endY - startY;
            
            if (Math.abs(dx) > Math.abs(dy)) {
                move(dx > 0 ? 'right' : 'left');
            } else {
                move(dy > 0 ? 'down' : 'up');
            }
        });
        
        initGame();
    </script>
</body>
</html>
